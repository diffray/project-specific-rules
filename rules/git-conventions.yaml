# Example: Git conventions
# Copy to .diffray/rules/ and customize for your team
#
# These rules enforce specific git workflow conventions:
# - Conventional Commits format (not all teams use this)
# - Atomic commits (some teams prefer squash merges)
# - Commit message format varies by organization

rules:
  - id: git_commit_message_format
    agent: quality
    title: Commit message format
    description: Commit messages should follow conventional format for readability and automation
    importance: 5
    match:
      file_glob:
        - '**/.git/COMMIT_EDITMSG'
        - '**/CHANGELOG.md'
      content_regex:
        - 'commit'
    checklist:
      - Check if commit messages follow team convention
      - Verify message includes type (feat, fix, refactor, etc.)
      - Look for clear description in imperative mood
    examples:
      bad: |
        fix stuff
        update code
        WIP
        Added user authentication
      good: |
        feat(auth): add user login with OAuth2
        fix(api): handle null response from external service
        refactor(db): extract repository pattern from service
        docs(readme): add API usage examples
    tags:
      - quality
      - git
    why_important: Consistent commit messages enable automated changelogs.

  - id: git_large_commit
    agent: quality
    title: Large commits with mixed changes
    description: Commits should be atomic - one logical change per commit
    importance: 6
    match:
      file_glob:
        - '**/*'
    checklist:
      - Check if commit includes unrelated changes
      - Verify feature and refactoring are separate commits
      - Suggest splitting into atomic commits
    examples:
      bad: |
        commit: "Add user auth and fix typos and update deps"
        - src/auth/login.ts (new feature)
        - src/utils/string.ts (typo fix)
        - package.json (dependency update)
      good: |
        commit 1: "chore(deps): update dependencies"
        commit 2: "fix(utils): correct typo in string helper"
        commit 3: "feat(auth): add user login with OAuth2"
    tags:
      - quality
      - git
    why_important: Atomic commits are easier to review, revert, and cherry-pick.
